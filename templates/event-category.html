{% extends 'base.html' %}


{% block title %}{{ category.category if category else "All Events"}} | MMU Event{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/Homepage.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .event-category-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Three columns */
            gap: 40px; /* Space between grid items */
            padding: 20px;
            margin: 0px 10px;
        }
        .event-cat-container {
            background-color: #f9f9f9;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.5s ease;
        }

        .event-details {
            background-color: #f9f9f9;
            border-radius: 0 0 10px 10px;
            padding: 20px;
        }

        .event-img {
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .event-cover {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        /* Adjustments for responsive design */
        @media (max-width: 768px) {
            .event-category-container {
                grid-template-columns: repeat(2, 1fr); /* Two columns on medium screens */
            }
        }

        @media (max-width: 480px) {
            .event-category-container {
                grid-template-columns: 1fr; /* One column on small screens */
            }
        }

        .categories-header {
            margin-bottom: 20px;
        }

        .search-form {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-filter input[type="text"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .search-filter select,
        .sort-filter select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .search-filter input[type="checkbox"] {
            margin-right: 5px;
        }

        .search-btn {
            padding: 5px 10px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .search-btn:hover {
            background-color: #0056b3;
        }

        .sort-filter {
            display: flex;
            align-items: center;
        }

        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
                align-items: flex-start;
            }

            .sort-filter {
                margin-top: 10px;
            }
        }

        /* Pagination styles */
        .pagination {
            display: flex;
            justify-content: center;
            padding: 10px 0;
            list-style-type: none;
        }

        .pagination li {
            margin: 0px;
        }

        .pagination li a {
            display: block;
            padding: 8px 12px;
            text-decoration: none;
            color: #007bff;
            transition: background-color 0.3s, color 0.3s;
        }

        .pagination li a:hover,
        .pagination li.active a {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination li.disabled a {
            color: #ccc;
            pointer-events: none;
            border-color: #ddd;
        }

        .pagination li.disabled .page-link {
            color: #ccc;
            cursor: default;
        }

    </style>
    
{% endblock %}

{% block content %}
    <div style="margin: 50px 100px;">
        <div class="categories-header">
            <h1>{{ category.category if category else "All Events" }}</h1>
            <form class="form-inline" method="GET" action="{{ url_for('event_category', category=category.category if category else None) }}">
                <input type="text" name="search" placeholder="Search events..." value="{{ search_query }}">

                <select name="venue_type">
                    <option value="">All Location</option>
                    <option value="On campus" {% if venue_filter == 'On campus' %}selected{% endif %}>On campus</option>
                    <option value="Off campus" {% if venue_filter == 'Off campus' %}selected{% endif %}>Off campus</option>
                    <option value="Online" {% if venue_filter == 'Online' %}selected{% endif %}>Online</option>
                </select>

                <input type="checkbox" name="expired" value="Expired">
                <label for="expired">Include Expired</label>

                <button type="submit" style="width: 100px;">Search</button>
                <a href="{{ url_for('event_category', category=category.category if category else None) }}">Reset</a>
                
                <label for="sort">Sort:</label>
                <select name="sort" id="sortDropdown">
                    <option value="">Default</option>
                    <option value="date" {% if sort == 'date' %}selected{% endif %}>Date</option>
                    <option value="a-z" {% if sort == 'a-z' %}selected{% endif %}>Alphabetically (A-Z)</option>
                    <option value="z-a" {% if sort == 'z-a' %}selected{% endif %}>Alphabetically (Z-A)</option>
                </select>

            </form>
        </div>
        <!-- Submit sort option without submit button -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('sortDropdown').addEventListener('change', function() {
                    this.form.submit();
                });
            });
        </script>
        
        <div class="event-category-container">
            {% for event in event %}
            <div class="event-cat-container">
            <div class="event-img parallax">
                <img src="{{ url_for('static', filename='images/' ~ (event.event_img or 'default_poster.png')) }}" 
                    alt="{{ event.event_name }}" class="event-cover">
            </div>
            <div class="event-details">
                <h3>{{ event.event_name }}</h3>
                <a href="{{ url_for('event_details', event_id=event.event_id) }}">
                <button class="view-details-btn">View Details</button>
                </a>
            </div>
            </div>
            {% endfor %}
            </div>
        </div>

        <!-- Pagination controls -->
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if pagination.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('event_category', category=category.category if category else None, page=pagination.prev_num, search=search_query, venue_type=venue_filter, sort=sort) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% endif %}
                
                {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=2, right_current=2) %}
                    {% if page_num %}
                        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('event_category', category=category.category if category else None, page=page_num, search=search_query, venue_type=venue_filter, sort=sort) }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
                    {% endif %}
                {% endfor %}
        
                {% if pagination.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{{ url_for('event_category', category=category.category if category else None, page=pagination.next_num, search=search_query, venue_type=venue_filter, sort=sort) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>        
    </div>
{% endblock %}